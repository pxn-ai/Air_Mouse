<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Air Mouse Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0f19 0%, #1a1a2e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }

        #app {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        canvas {
            display: block;
        }

        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(25, 25, 45, 0.9);
            border: 1px solid rgba(100, 100, 180, 0.3);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            min-width: 280px;
        }

        .panel-title {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #00c8ff;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .port-select {
            width: 100%;
            padding: 10px 12px;
            background: rgba(40, 40, 70, 0.8);
            border: 1px solid rgba(100, 100, 180, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .port-select:focus {
            outline: none;
            border-color: #00c8ff;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00c8ff, #0080ff);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 200, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(100, 100, 140, 0.3);
            color: #c8c8dc;
            border: 1px solid rgba(100, 100, 180, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(100, 100, 140, 0.5);
        }

        .btn-demo {
            background: linear-gradient(135deg, #ff6496, #ff4080);
        }

        .btn-demo.active {
            background: linear-gradient(135deg, #64ff96, #40ff80);
            color: #000;
        }

        /* Status Display */
        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: rgba(40, 40, 70, 0.5);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff6496;
            transition: background 0.3s;
        }

        .status-dot.connected {
            background: #64ff96;
            box-shadow: 0 0 10px #64ff96;
        }

        .status-text {
            color: #c8c8dc;
            font-size: 13px;
        }

        /* Data Display */
        .data-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(25, 25, 45, 0.9);
            border: 1px solid rgba(100, 100, 180, 0.3);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            min-width: 250px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 100, 180, 0.2);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #808090;
            font-size: 14px;
        }

        .data-value {
            color: #00c8ff;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 16px;
            font-weight: 600;
        }

        /* Title */
        .title {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #fff;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(0, 200, 255, 0.5);
        }

        .subtitle {
            color: #808090;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Instructions */
        .instructions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #505060;
            font-size: 12px;
            text-align: right;
        }

        .instructions kbd {
            background: rgba(100, 100, 140, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }

        /* Web Serial API not supported message */
        .not-supported {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid #ff6464;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            color: #ff6464;
            max-width: 400px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <canvas id="canvas"></canvas>

        <div class="title">
            Air Mouse Simulation
            <div class="subtitle">ESP32-S3 + MPU-6500 Sensor</div>
        </div>

        <div class="control-panel">
            <div class="panel-title">Connection</div>
            
            <div class="status">
                <div class="status-dot" id="statusDot"></div>
                <span class="status-text" id="statusText">Not Connected</span>
            </div>

            <button class="btn btn-primary" id="connectBtn" onclick="connectSerial()">
                üîå Connect Serial Port
            </button>
            
            <button class="btn btn-secondary btn-demo" id="demoBtn" onclick="toggleDemo()">
                üé¨ Demo Mode
            </button>
            
            <button class="btn btn-secondary" onclick="recenter()">
                üéØ Recenter Pointer
            </button>
        </div>

        <div class="data-display">
            <div class="data-row">
                <span class="data-label">Pitch</span>
                <span class="data-value" id="pitchValue">0.00¬∞</span>
            </div>
            <div class="data-row">
                <span class="data-label">Roll</span>
                <span class="data-value" id="rollValue">0.00¬∞</span>
            </div>
            <div class="data-row">
                <span class="data-label">Position</span>
                <span class="data-value" id="posValue">(0, 0)</span>
            </div>
        </div>

        <div class="instructions">
            <div><kbd>D</kbd> Demo Mode</div>
            <div><kbd>R</kbd> Recenter</div>
            <div><kbd>C</kbd> Connect</div>
        </div>

        <div class="not-supported" id="notSupported">
            <h2>‚ö†Ô∏è Web Serial API Not Supported</h2>
            <p style="margin-top: 15px; color: #c8c8dc;">
                Your browser doesn't support the Web Serial API.<br><br>
                Please use <strong>Google Chrome</strong> or <strong>Microsoft Edge</strong> to connect to serial devices.<br><br>
                You can still use <strong>Demo Mode</strong> to see the simulation!
            </p>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CONFIGURATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const SENSITIVITY_X = 10.0;
        const SENSITIVITY_Y = 10.0;
        const SMOOTHING_SAMPLES = 5;

        // Colors
        const BG_COLOR = '#0f0f19';
        const GRID_COLOR = 'rgba(30, 30, 50, 0.8)';
        const POINTER_COLOR = '#00c8ff';
        const ACCENT_COLOR = '#ff6496';
        const TRAIL_COLOR = '#00c8ff';

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // STATE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let canvas, ctx;
        let width, height;
        let port = null;
        let reader = null;
        let connected = false;
        let demoMode = false;
        let demoTime = 0;

        // Pointer state
        let pointerX, pointerY;
        let targetX, targetY;
        let pointerAngle = -45;

        // Sensor data
        let lastPitch = 0, lastRoll = 0;
        let pitchBuffer = [], rollBuffer = [];

        // Trail
        let trail = [];
        const MAX_TRAIL = 40;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INITIALIZATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function init() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            resize();
            window.addEventListener('resize', resize);

            // Check Web Serial API support
            if (!('serial' in navigator)) {
                document.getElementById('notSupported').style.display = 'block';
                demoMode = true;
                updateDemoButton();
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'd') toggleDemo();
                if (e.key.toLowerCase() === 'r') recenter();
                if (e.key.toLowerCase() === 'c') connectSerial();
            });

            // Start animation loop
            requestAnimationFrame(animate);
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            
            if (pointerX === undefined) {
                pointerX = width / 2;
                pointerY = height / 2;
                targetX = pointerX;
                targetY = pointerY;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SERIAL CONNECTION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function connectSerial() {
            if (!('serial' in navigator)) {
                alert('Web Serial API not supported. Please use Chrome or Edge.');
                return;
            }

            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                
                connected = true;
                demoMode = false;
                updateStatus('Connected', true);
                updateDemoButton();

                readSerialData();
            } catch (e) {
                console.error('Serial connection failed:', e);
                updateStatus('Connection failed', false);
            }
        }

        async function readSerialData() {
            const decoder = new TextDecoderStream();
            const inputDone = port.readable.pipeTo(decoder.writable);
            reader = decoder.readable.getReader();

            let buffer = '';

            try {
                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    
                    buffer += value;
                    const lines = buffer.split('\n');
                    buffer = lines.pop(); // Keep incomplete line

                    for (const line of lines) {
                        parseSensorData(line.trim());
                    }
                }
            } catch (e) {
                console.error('Read error:', e);
                connected = false;
                updateStatus('Disconnected', false);
            }
        }

        function parseSensorData(line) {
            // Expected: "Pitch: 12.34  | Roll: 56.78    (Accel Z: 0.99)"
            const match = line.match(/Pitch:\s*([-\d.]+).*Roll:\s*([-\d.]+)/);
            if (match) {
                const pitch = parseFloat(match[1]);
                const roll = parseFloat(match[2]);
                
                pitchBuffer.push(pitch);
                rollBuffer.push(roll);
                
                if (pitchBuffer.length > SMOOTHING_SAMPLES) pitchBuffer.shift();
                if (rollBuffer.length > SMOOTHING_SAMPLES) rollBuffer.shift();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI CONTROLS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function toggleDemo() {
            demoMode = !demoMode;
            updateDemoButton();
            if (demoMode) {
                updateStatus('Demo Mode', false);
            } else if (!connected) {
                updateStatus('Not Connected', false);
            }
        }

        function updateDemoButton() {
            const btn = document.getElementById('demoBtn');
            if (demoMode) {
                btn.classList.add('active');
                btn.textContent = '‚úì Demo Mode Active';
            } else {
                btn.classList.remove('active');
                btn.textContent = 'üé¨ Demo Mode';
            }
        }

        function updateStatus(text, isConnected) {
            document.getElementById('statusText').textContent = text;
            const dot = document.getElementById('statusDot');
            if (isConnected) {
                dot.classList.add('connected');
            } else {
                dot.classList.remove('connected');
            }
        }

        function recenter() {
            pointerX = width / 2;
            pointerY = height / 2;
            targetX = pointerX;
            targetY = pointerY;
            trail = [];
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ANIMATION LOOP
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        function update() {
            let dx = 0, dy = 0;

            if (connected && pitchBuffer.length > 0) {
                // Use smoothed sensor values
                lastPitch = pitchBuffer.reduce((a, b) => a + b) / pitchBuffer.length;
                lastRoll = rollBuffer.reduce((a, b) => a + b) / rollBuffer.length;
                
                dx = lastRoll * SENSITIVITY_X * 0.1;
                dy = -lastPitch * SENSITIVITY_Y * 0.1;
            } else if (demoMode) {
                // Demo: Figure-8 motion
                demoTime += 0.025;
                lastPitch = 25 * Math.sin(demoTime);
                lastRoll = 25 * Math.sin(demoTime * 0.5);
                
                dx = lastRoll * SENSITIVITY_X * 0.08;
                dy = -lastPitch * SENSITIVITY_Y * 0.08;
            }

            // Update target
            targetX += dx;
            targetY += dy;

            // Clamp to bounds
            const margin = 80;
            targetX = Math.max(margin, Math.min(width - margin, targetX));
            targetY = Math.max(margin, Math.min(height - margin, targetY));

            // Smooth movement (lerp)
            pointerX += (targetX - pointerX) * 0.15;
            pointerY += (targetY - pointerY) * 0.15;

            // Update angle
            if (Math.abs(dx) > 0.3 || Math.abs(dy) > 0.3) {
                pointerAngle = Math.atan2(dy, dx) * 180 / Math.PI - 45;
            }

            // Trail
            trail.push({ x: pointerX, y: pointerY });
            if (trail.length > MAX_TRAIL) trail.shift();

            // Update display
            document.getElementById('pitchValue').textContent = lastPitch.toFixed(2) + '¬∞';
            document.getElementById('rollValue').textContent = lastRoll.toFixed(2) + '¬∞';
            document.getElementById('posValue').textContent = `(${Math.round(pointerX)}, ${Math.round(pointerY)})`;
        }

        function draw() {
            // Clear
            ctx.fillStyle = BG_COLOR;
            ctx.fillRect(0, 0, width, height);

            // Grid
            drawGrid();

            // Center crosshair
            drawCrosshair();

            // Trail
            drawTrail();

            // Pointer
            drawPointer();
        }

        function drawGrid() {
            ctx.strokeStyle = GRID_COLOR;
            ctx.lineWidth = 1;

            const spacing = 50;
            for (let x = 0; x < width; x += spacing) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += spacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
        }

        function drawCrosshair() {
            const cx = width / 2, cy = height / 2;
            ctx.strokeStyle = ACCENT_COLOR;
            ctx.lineWidth = 2;
            ctx.setLineDash([8, 4]);

            ctx.beginPath();
            ctx.moveTo(cx - 50, cy);
            ctx.lineTo(cx + 50, cy);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(cx, cy - 50);
            ctx.lineTo(cx, cy + 50);
            ctx.stroke();

            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(cx, cy, 8, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawTrail() {
            if (trail.length < 2) return;

            for (let i = 1; i < trail.length; i++) {
                const alpha = i / trail.length;
                const width = 1 + alpha * 6;
                
                ctx.strokeStyle = `rgba(0, 200, 255, ${alpha * 0.6})`;
                ctx.lineWidth = width;
                ctx.lineCap = 'round';

                ctx.beginPath();
                ctx.moveTo(trail[i-1].x, trail[i-1].y);
                ctx.lineTo(trail[i].x, trail[i].y);
                ctx.stroke();
            }
        }

        function drawPointer() {
            ctx.save();
            ctx.translate(pointerX, pointerY);
            ctx.rotate(pointerAngle * Math.PI / 180);

            // Glow
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 60);
            gradient.addColorStop(0, 'rgba(0, 200, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 200, 255, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, 60, 0, Math.PI * 2);
            ctx.fill();

            // Arrow shape
            const size = 35;
            ctx.beginPath();
            ctx.moveTo(size, 0);           // Tip
            ctx.lineTo(-size/2, -size/2);  // Top back
            ctx.lineTo(-size/4, 0);        // Notch
            ctx.lineTo(-size/2, size/2);   // Bottom back
            ctx.closePath();

            ctx.fillStyle = POINTER_COLOR;
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.restore();
        }

        // Start
        window.onload = init;
    </script>
</body>
</html>
